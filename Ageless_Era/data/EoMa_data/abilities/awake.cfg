#textdomain wesnoth-Ageless_Era

#define ABILITY_AWAKE
    [dummy]
        id=i8awake
        name= _ "Awake"
        description= _ "Awake: 
If a friendly adjacent unit with more than one hitpoint at the beginning of the battle dies, it is resurrected and remains in battle with one hitpoint. If it dies again (having one hitpoint), it will be killed for sure."
    [/dummy]
[/abilities]
[event]
    name=attack
    first_time_only=no
    [filter]
        [filter_adjacent]
            is_enemy=no
            ability=i8awake
        [/filter_adjacent]
        [not]
            [filter_wml]
                [status]
                    not_living=yes
                [/status]
            [/filter_wml]
        [/not]
    [/filter]

    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
        variable=candidate.a
    [/store_unit]
[/event]
[event]
    name=attack
    first_time_only=no
    [filter_second]
        [filter_adjacent]
            is_enemy=no
            ability=i8awake
        [/filter_adjacent]
        [not]
            [filter_wml]
                [status]
                    not_living=yes
                [/status]
            [/filter_wml]
        [/not]
    [/filter_second]

    [store_unit]
        [filter]
            x,y=$x2,$y2
        [/filter]
        variable=candidate.d
    [/store_unit]
[/event]

[event]
    name=die
    first_time_only=no
    [filter]
        find_in=candidate.a
        [or]
            find_in=candidate.d
        [/or]
    [/filter]
    [if]
        [variable]
            name=unit.id
            equals=$candidate.d.id
        [/variable]
        [and]
            [variable]
                name=candidate.d.hitpoints
                greater_than=1
            [/variable]
        [/and]
        [then]
            {VARIABLE unit.hitpoints 1}
            [unstore_unit]
                variable=unit
                find_vacant=no
                text=_ "awaked"
                {COLOR_HEAL}
            [/unstore_unit]
            {CLEAR_VARIABLE candidate}
        [/then]
    [/if]
    [if]
        [variable]
            name=unit.id
            equals=$candidate.a.id
        [/variable]
        [and]
            [variable]
                name=candidate.a.hitpoints
                greater_than=1
            [/variable]
        [/and]
        [then]
            {VARIABLE unit.hitpoints 1}
            [unstore_unit]
                variable=unit
                find_vacant=no
                text=_ "awaked"
                {COLOR_HEAL}
            [/unstore_unit]
            {CLEAR_VARIABLE candidate}
        [/then]
    [/if]
[/event]
[+abilities]
#enddef
