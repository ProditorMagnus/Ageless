#textdomain wesnoth-Ageless_Era

#define KIRIOS_OPPOSITE_SIDE CENTER_X CENTER_Y X Y VAR
    {VARIABLE x_odd {X}}

    {VARIABLE_OP x_odd modulo 2}

    {VARIABLE c_x {CENTER_X}}
    {VARIABLE c_y {CENTER_Y}}
    {VARIABLE s_x {X}}
    {VARIABLE s_y {Y}}

    {VARIABLE result_x {CENTER_X}}
    {VARIABLE result_y {CENTER_Y}}

    {IF_VAR s_x greater_than $c_x (
        [then]
            {VARIABLE_OP result_x add -1}
        [/then]
    )}

    {IF_VAR s_x less_than $c_x (
        [then]
            {VARIABLE_OP result_x add 1}
        [/then]
    )}

    {IF_VAR s_x equals $c_x (
        [then]
            {IF_VAR s_y less_than $c_y (
                [then]
                    {VARIABLE_OP result_y add 1}
                [/then]
            )}

            {IF_VAR s_y greater_than $c_y (
                [then]
                    {VARIABLE_OP result_y add -1}
                [/then]
            )}
        [/then]
    )}

    {IF_VAR x_odd equals 1 (
        [then]
            {IF_VAR s_y equals $c_y (
                [then]
                    {VARIABLE_OP result_y add 1}
                [/then]
            )}
        [/then]

        [else]
            {IF_VAR s_y equals $c_y (
                [then]
                    {VARIABLE_OP result_y add -1}
                [/then]
            )}
        [/else]
    )}
    {VARIABLE {VAR}.x $result_x}
    {VARIABLE {VAR}.y $result_y}

    {CLEAR_VARIABLE c_x}
    {CLEAR_VARIABLE c_y}
    {CLEAR_VARIABLE s_x}
    {CLEAR_VARIABLE s_y}
    {CLEAR_VARIABLE result_x}
    {CLEAR_VARIABLE result_y}
    {CLEAR_VARIABLE x_odd}
#enddef

#define KIRIOS_BEAM WEAPON DMG
    [event]
        name=attacker_hits
        first_time_only=no

        [filter_attack]
            name={WEAPON}
        [/filter_attack]

        {KIRIOS_OPPOSITE_SIDE $x2 $y2 $x1 $y1 target_hex}

        [store_unit]
            [filter]
                x,y=$target_hex.x,$target_hex.y
            [/filter]
            variable=third
        [/store_unit]

        [if]
            [variable]
                name=third.hitpoints
                less_than_equal_to={DMG}
            [/variable]
            [then]
                [if]
                    [have_unit]
                        x=$third.x
                        y=$third.y
                    [/have_unit]
                    [then]
                        [unstore_unit]
                            variable=third
                            {COLOR_HARM}
                            text="{DMG}"
                        [/unstore_unit]
                        [kill]
                            x=$third.x
                            y=$third.y
                            fire_event=yes
                            animate=yes
                        [/kill]
                    [/then]
                [/if]
            [/then]
            [else]
                {VARIABLE dmgpuffer {DMG}}
                {VARIABLE_OP dmgpuffer multiply -1}
                {VARIABLE_OP third.hitpoints add $dmgpuffer}
                [unstore_unit]
                    variable=third
                    {COLOR_HARM}
                    text="{DMG}"
                [/unstore_unit]
            [/else]
        [/if]

        {CLEAR_VARIABLE target_hex}
        {CLEAR_VARIABLE third}
    [/event]
#enddef
